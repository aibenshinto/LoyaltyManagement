<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Coupon</title>
</head>
<body>
    <h2>Create a Coupon</h2>

    <!-- Form for creating a coupon -->
    <form id="couponForm">
        <label for="couponType">Coupon Type:</label>
        <select id="couponType" name="coupon_type">
            <option value="discount">Discount</option>
            <option value="bogo">BOGO</option>
        </select><br><br>

        <label for="code">Coupon Code:</label>
        <input type="text" id="code" name="code" required><br><br>

        <label for="minPurchaseAmount">Minimum Purchase Amount:</label>
        <input type="number" id="minPurchaseAmount" name="min_purchase_amount" step="0.01" required><br><br>

        <label for="validFrom">Valid From:</label>
        <input type="datetime-local" id="validFrom" name="valid_from" required><br><br>

        <label for="validUntil">Valid Until:</label>
        <input type="datetime-local" id="validUntil" name="valid_until" required><br><br>

        <!-- Fields specific to discount coupons -->
        <div id="discountFields">
            <label for="discountAmount">Discount Amount:</label>
            <input type="number" id="discountAmount" name="discount_amount" step="0.01"><br><br>

            <label for="discountPercentage">Discount Percentage:</label>
            <input type="number" id="discountPercentage" name="discount_percentage" step="0.01"><br><br>
        </div>

        <!-- Fields specific to BOGO coupons -->
        <div id="bogoFields" style="display: none;">
            <label for="productToBuy">Product to Buy:</label>
            <input type="text" id="productToBuy" name="product_to_buy"><br><br>

            <label for="freeProduct">Free Product:</label>
            <input type="text" id="freeProduct" name="free_product"><br><br>
        </div>

        <button type="submit">Create Coupon</button>
    </form>

    <!-- Script to handle form submission and send data using fetch API -->
    <script>
        document.getElementById('couponType').addEventListener('change', function() {
            const couponType = this.value;
            if (couponType === 'discount') {
                document.getElementById('discountFields').style.display = 'block';
                document.getElementById('bogoFields').style.display = 'none';
            } else if (couponType === 'bogo') {
                document.getElementById('discountFields').style.display = 'none';
                document.getElementById('bogoFields').style.display = 'block';
            }
        });

        document.getElementById('couponForm').addEventListener('submit', function(event) {
            event.preventDefault();

            const formData = new FormData(this);
            const data = {};

            // Convert FormData to JSON
            formData.forEach((value, key) => {
                data[key] = value;
            });

            fetch('http://localhost:8000/api/coupons/create/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Token ' + localStorage.getItem('token')  // Assume token is stored in localStorage
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    alert(data.message);  // Display success message
                } else {
                    alert('Error: ' + JSON.stringify(data));  // Display error messages
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script>
</body>
</html>
